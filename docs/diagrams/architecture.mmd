%% use this to compile it:
%% mmdc -i docs/diagrams/architecture.mmd -o ./docs/gp1/images/architecture.png -w 900
graph TB
    subgraph "Frontend (Mishkat)"
        A[iOS SwiftUI App]
        L[EventKit]
        N[iOS Calendar System]
    end

    subgraph "Backend (Falak)"
        B[gRPC Server]
        C[Auth Service]
        D[Credential Service]
        E[Event Service]
    end

    subgraph "WhatsApp Service"
        W[Node.js Service]
        LLM[LLM Service]
    end

    subgraph "External Calendar Services"
        M[Calendar Servers]
    end

    subgraph "Database"
        H[(PostgreSQL)]
    end

    A --UI Events--> L
    L --Calendar Data--> A
    L --Sync--> N
    N --CalDAV/Exchange--> M
    
    A --gRPC--> B
    B --> C
    B --> D
    B --> E

    W --Monitor Messages--> W
    W --Extract Event--> LLM
    LLM --Event Data--> W
    W --gRPC--> E
    E --Add to Calendar--> D

    C --> H
    D --> H
    E --> H
    W --> H

    classDef frontend fill:#f9f,stroke:#333,stroke-width:4px;
    classDef backend fill:#bbf,stroke:#333,stroke-width:2px;
    classDef external fill:#bfb,stroke:#333,stroke-width:2px;
    classDef database fill:#fbb,stroke:#333,stroke-width:2px;
    classDef whatsapp fill:#fbf,stroke:#333,stroke-width:2px;

    class A,L,N frontend;
    class B,C,D,E backend;
    class M external;
    class H database;
    class W,LLM whatsapp;